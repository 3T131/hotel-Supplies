<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.accp.dao.PassengerDao">

    <resultMap id="listMap" type="Passenger">
        <id property="pId" column="pId"/>
        <result property="genderName" column="genderName"/>
        <result property="nationName" column="nationName"/>
        <result property="passengerLevelName" column="passengerLevelName"/>
        <result property="papersName" column="papersName"/>
    </resultMap>
    <sql id="queryPassenger">
         SELECT passenger.*,
            gender.attributeDetailsName genderName,
            nation.attributeDetailsName nationName,
           passengerLevel.attributeDetailsName passengerLevelName,
           papers.attributeDetailsName papersName

           FROM passenger
            INNER JOIN attributedetails gender ON passenger.genderid=gender.attributedetailsId
            INNER JOIN attributedetails nation ON passenger.nationid=nation.attributedetailsId
            INNER JOIN attributedetails passengerLevel ON passenger.passengerlevelid=passengerLevel.attributedetailsId
            INNER JOIN attributedetails papers ON passenger.papersid=papers.attributedetailsId
       </sql>
    <select id="list" resultMap="listMap">
        <include refid="queryPassenger"></include>
        <where>
            <if test="name!=null and name!=''">
                and name like concat('%',#{name},'%')
            </if>
        </where>
    </select>
    <insert id="add">
        INSERT  INTO `passenger`(`pId`,`papersID`,`genderID`,
        `passengerLevelID`,`nationID`,`name`,`papersNumber`,
        `birthDate`,`papersValidity`,`PhoneNumber`,`remarks`)
        VALUES (DEFAULT,#{papersID},#{genderID},#{passengerLevelID},#{nationID},
        #{name},#{papersNumber},#{birthDate},#{papersValidity},#{phoneNumber},#{remarks})
    </insert>
    <delete id="delete" parameterType="java.lang.String">
        DELETE FROM passenger WHERE pId IN
        <foreach collection="array" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>
    <select id="queryPassengerId" resultMap="listMap">
        <include refid="queryPassenger"></include>
        WHERE pId=#{pId}
    </select>
    <update id="update">
        UPDATE passenger
        <set>
            <if test="name!=null and name!=''">
                passenger.name=#{name},
            </if>
            <if test="nationID>0">
                passenger.`nationID`=#{nationID},
            </if>
            <if test="genderID>0">
                passenger.`genderID`=#{genderID},
            </if>
            <if test="papersValidity!=null and papersValidity!=''">
                passenger.`papersValidity`=#{papersValidity},
            </if>
            <if test="birthDate!=null and birthDate!=''">
                passenger.`birthDate`=#{birthDate},
            </if>
            <if test="papersID>0">
                passenger.`papersID`=#{papersID},
            </if>
            <if test="passengerLevelID>0">
                passenger.`passengerLevelID`=#{passengerLevelID},
            </if>
            <if test="papersNumber!=null and papersNumber!=''">
                passenger.`papersNumber`=#{papersNumber},
            </if>
            <if test="remarks!=null and remarks!=''">
                passenger.`remarks`=#{remarks},
            </if>
            <if test="phoneNumber!=null and phoneNumber!=''">
                passenger.`PhoneNumber`=#{phoneNumber}
            </if>
        </set>
        WHERE passenger.`pId`=#{pId}

    </update>
</mapper>